# 名刺OCR & 重複確認デモ

このアプリケーションは、名刺画像をOCRで解析し、データベースに登録する機能を持つStreamlitアプリです。LangGraphを活用したワークフローで、名刺データの重複チェックと処理を効率的に行います。

## 主な機能

- **名刺OCR処理**: アップロードされた名刺画像から文字情報を抽出（GPT-4oを使用）
- **重複チェック**: 既存データベースとの重複を自動検出
- **重複解決フロー**: 重複データの上書きまたはスキップをユーザーが選択可能
- **データ管理**: SQLiteデータベースによる名刺データの永続化

## 技術スタック

- **Streamlit**: UIフレームワーク
- **OpenAI API (GPT-4o)**: 画像OCR処理
- **LangGraph**: ワークフロー制御
- **SQLite**: データベース

## プロジェクト構造

アプリケーションは以下のモジュールに分割されています：

- **app.py**: メインアプリケーションのエントリーポイント。各モジュールを連携させる役割。
- **models.py**: データモデルや型定義。CardやStateなどの型を定義。
- **db.py**: データベース操作の責務を持つ。DB初期化、保存、照会機能を提供。
- **ocr.py**: OpenAI APIを使用した画像OCR処理。名刺画像からデータを抽出。
- **graph.py**: LangGraphワークフローの定義。重複チェックや決定適用のノードを含む。
- **ui.py**: Streamlit UIコンポーネント。各画面やフォームのレンダリングを担当。

このモジュール分割により、コードの再利用性、テスト容易性、保守性が向上しています。

## 使用方法

1. 名刺画像を選択（複数枚同時処理可能）
2. 「解析開始」ボタンをクリック
3. 重複がある場合は、各エントリに対して「上書き」または「スキップ」を選択
4. 「決定して保存」ボタンをクリックして処理を完了

## ワークフロー

1. **OCR処理**: 名刺画像から名前、会社名、メールアドレス、電話番号などを抽出
2. **重複チェック**: メールアドレスを基に既存データとの重複をチェック
3. **ユーザー決定**: 重複がある場合はユーザーに選択を促す
4. **データ保存**: 新規データと上書き指定されたデータをデータベースに保存

## 必要な環境変数

- `OPENAI_API_KEY`: OpenAI APIキー（事前に設定が必要）

## 依存パッケージ

- streamlit
- openai
- langgraph (0.3以降)
- sqlite3 (Python標準ライブラリ)
- pandas (データ表示用)

## 実行方法

```bash
# 必要なパッケージをインストール
pip install streamlit openai langgraph pandas

# 環境変数を設定（Windowsの場合）
set OPENAI_API_KEY=your_api_key_here

# アプリケーションを実行
streamlit run app.py
```
